__version__ = 0.001
__abstract__ = False

from BrainStdBECore.WeightedPathway import WeightedPathway as WeightedPathway
from BrainStdBECore.BSException import BSException as BSException
import exceptions

class BrainStdBEClass(WeightedPathway) :
    
    def __init__(self) :
        super(BrainStdBEClass,self).__init__()
        self.pathway_parameters.append('delay')
        self.pathway_parameters.append('plastic')
        self.pathway_parameters_default.append('RANDI(1,60)')
        self.pathway_parameters_default.append('False')
        self.configurations['NeMoSynapticPathway'] = (self.pathway_parameters, [], self.pathway_parameters_defualt, [])
        self.size = 0
        
        self.architecture = 'NeMo'
        self.input_model = 'spike'
        self.output_model = 'spike'
        self.synapses = []
   
    def get_version(self):
        return __version__
        
    def initialize(self, brain, node, args):
        super(BrainStdBEClass,self).initialize(brain, node, args)
        self.brain = brain
        return self.size
        
    def add_synapses(self, brain, source, targets, synapse_args):
        
        delays = []
        weights=[]
        plastic =[]
        
        t=0
        for sa in synapse_args:
            paras = sa[0]
            delays.append(paras['delay'])
            weights.append(paras['weight'])
            plastic.append(paras['plastic'])   
            targets[t] =targets[t]+self.target.get_start_neuron()
        try:            
            s = brain.add_nemo_synapse(source+self.source.get_start_neuron(), targets, delays, weights, plastic)
            self.synapses.append((s[0], len(s)))
        except exceptions.BaseException as e:
            where = self.get_where()
            what = 'Error in NeMo adding synapses: ' + e.args[0]
            raise BSException(where, what)
       
        self.size += len(targets)

    def get_all_data(self):
        weights=list()        
        for s in self.synapse:
            indexes = range(s[1],s[1]+s[2])
            weights.append(self.brain.get_nemo_synapse_weight(indexes))
        return weights      
        
    def get_data(self, args):
        return


    
        
        
 
