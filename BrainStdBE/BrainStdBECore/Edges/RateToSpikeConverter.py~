__version__ = 0.001
__abstract__ = False

from BrainStdBECore.Edge import Edge as Edge
from BrainStdBECore.BSException import BSException as BSException 
import numpy as np

class BrainStdBEClass(Edge) :
    
    def __init__(self) :
        super(BrainStdBEClass,self).__init__()
        self.configurations['RateToSpikeConverter'] = (['weight'], [])
        
        self.input_model = 'rate'
        self.output_model = 'spike'
   
    def get_version(self):
        return __version__
        
    def initialize(self, brain, node, args):        
        super(BrainStdBEClass,self).initialize(brain, node, args)

        where = self.get_where()  
        
        self.get_connection_ranges(node)
        
        if self.preLast-self.preFirst != self.postLast-self.postFirst:
            what = 'Error input and output sizes differ'
            raise BSException(where, what)
        
        formulas = self.construct_formulas(node)
        
        self.weights = np.zeros(self.preLast-self.preFirst+1)
        count = 0
        for n in range(self.preFirst, self.preLast+1):
            sa = self.evaluate_formulas(formulas, node, self.attributes, dict(), dict())  
            paras = sa[0]
            self.weights[count] = paras['weight']
            count += 1
            
    def get_all_data(self):
        return list(self.weights)
        
    def get_data(self, args):       
        args = {'first_neuron' :  self.preFirst, 'last' : self.preLast }
        inputs = self.source.get_data(args)      
        outputs = np.multiply(inputs, self.weights)
        args = {'inputs' : outputs, 'first_neuron' :  self.postFirst, 'last' : self.postLast }
        self.target.set_data(args)


        
        
 